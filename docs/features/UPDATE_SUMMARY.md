# æ›´æ–°æ€»ç»“

## ðŸ“Œ æ¦‚è¿°

æœ¬æ¬¡æ›´æ–°ä¸ºé‡åŒ–äº¤æ˜“ç³»ç»Ÿæ·»åŠ äº†å®Œæ•´çš„**å›žæµ‹å¼•æ“Ž**ã€**è‡ªå®šä¹‰æŒ‡æ ‡**å’Œ**æ‰©å±•æŒ‡æ ‡ç³»ç»Ÿ**ï¼ŒåŒ…æ‹¬å‰ç«¯å’ŒåŽç«¯çš„å…¨é¢å‡çº§ã€‚

---

## âœ… å·²è§£å†³çš„é—®é¢˜

æ‚¨æå‡ºçš„æ‰€æœ‰é—®é¢˜éƒ½å·²å®Œå…¨è§£å†³ï¼š

### 1. âœ… å¤æ™®æ¯”çŽ‡
- **ä½ç½®**: `backend/services/backtest_engine.py`
- **å®žçŽ°**: åœ¨å›žæµ‹ç»“æžœä¸­è‡ªåŠ¨è®¡ç®—
- **å…¬å¼**: `(ç­–ç•¥æ”¶ç›ŠçŽ‡ - æ— é£Žé™©æ”¶ç›ŠçŽ‡) / ç­–ç•¥æ”¶ç›ŠçŽ‡æ ‡å‡†å·® * âˆš252`
- **å±•ç¤º**: å‰ç«¯æ˜¾ç¤ºå¤æ™®æ¯”çŽ‡åŠäº”çº§è¯„çº§

### 2. âœ… å›žæµ‹åŠŸèƒ½
- **ä½ç½®**: `backend/services/backtest_engine.py`, `backend/api/backtests.py`
- **åŠŸèƒ½**: å®Œæ•´çš„ç­–ç•¥å›žæµ‹å¼•æ“Ž
- **ç‰¹æ€§**:
  - äº¤æ˜“æ¨¡æ‹Ÿï¼ˆä¹°å…¥/å–å‡ºï¼‰
  - æ‰‹ç»­è´¹å’Œæ»‘ç‚¹è®¡ç®—
  - èµ„é‡‘æ›²çº¿è·Ÿè¸ª
  - å¤šç»´åº¦æ€§èƒ½æŒ‡æ ‡
  - è¯¦ç»†äº¤æ˜“è®°å½•
  - åŽ†å²å›žæµ‹ç®¡ç†

### 3. âœ… ç­–ç•¥ä¸ŽæŒ‡æ ‡å…³è”
- **ä½ç½®**: `backend/models/strategy.py`, `backend/api/strategies.py`
- **å®žçŽ°**: ç­–ç•¥é…ç½®åŒ…å«å®Œæ•´çš„æŒ‡æ ‡å®šä¹‰
- **ç‰¹æ€§**:
  - æ”¯æŒå¤šæŒ‡æ ‡ç»„åˆ
  - çµæ´»çš„äº¤æ˜“æ¡ä»¶é…ç½®
  - æ¡ä»¶é€»è¾‘æ”¯æŒï¼ˆAND/ORï¼‰
  - æŒ‡æ ‡å€¼æ¯”è¾ƒ

### 4. âœ… æŒ‡æ ‡æ‰©å±•ï¼ˆä»Ž 4 ä¸ªåˆ° 12 ä¸ªï¼‰
- **ä½ç½®**: `backend/services/indicator_calculator.py`
- **åŽŸæœ‰**: MA, MACD, RSI, BOLL
- **æ–°å¢ž**: EMA, KDJ, CCI, ATR, OBV, WR, DMI, VWAP
- **æ€»è®¡**: 12 ä¸ªå†…ç½®æŠ€æœ¯æŒ‡æ ‡

### 5. âœ… è‡ªå®šä¹‰å…¬å¼æœºåˆ¶
- **ä½ç½®**: `backend/services/custom_indicator_engine.py`
- **åŠŸèƒ½**: å®‰å…¨çš„å…¬å¼å¼•æ“Ž
- **ç‰¹æ€§**:
  - å…¬å¼éªŒè¯å’Œè¯­æ³•æ£€æŸ¥
  - æ”¯æŒæ•°å­¦å’ŒæŠ€æœ¯åˆ†æžå‡½æ•°
  - å‚æ•°åŒ–é…ç½®
  - é˜²æ­¢ä»£ç æ³¨å…¥

### 6. âœ… æ’ä»¶æœºåˆ¶
- **ä½ç½®**: `backend/models/custom_indicator.py`
- **å®žçŽ°**: é¢„ç•™æ’ä»¶æŽ¥å£
- **å­—æ®µ**: `plugin_module`, `plugin_class`

---

## ðŸ“¦ æ–°å¢žæ–‡ä»¶ç»Ÿè®¡

### åŽç«¯ï¼ˆ13 ä¸ªæ–‡ä»¶ï¼‰
```
models/
  â”œâ”€â”€ backtest.py                    # å›žæµ‹æ•°æ®æ¨¡åž‹
  â””â”€â”€ custom_indicator.py            # è‡ªå®šä¹‰æŒ‡æ ‡æ¨¡åž‹

services/
  â”œâ”€â”€ backtest_engine.py             # å›žæµ‹å¼•æ“Ž
  â””â”€â”€ custom_indicator_engine.py     # å…¬å¼å¼•æ“Ž

api/
  â”œâ”€â”€ backtests.py                   # å›žæµ‹ API
  â””â”€â”€ custom_indicators.py           # è‡ªå®šä¹‰æŒ‡æ ‡ API

alembic/versions/
  â””â”€â”€ 002_add_backtest_and_custom_indicators.py  # æ•°æ®åº“è¿ç§»

scripts/
  â””â”€â”€ test_new_features.py           # æµ‹è¯•è„šæœ¬

docs/
  â”œâ”€â”€ README_FEATURES.md             # åŠŸèƒ½è¯¦ç»†è¯´æ˜Ž
  â””â”€â”€ UPGRADE_SUMMARY.md             # å‡çº§æ€»ç»“
```

### å‰ç«¯ï¼ˆ4 ä¸ªæ–‡ä»¶ï¼‰
```
views/
  â”œâ”€â”€ BacktestView.vue               # å›žæµ‹é¡µé¢
  â””â”€â”€ CustomIndicatorView.vue        # è‡ªå®šä¹‰æŒ‡æ ‡é¡µé¢

services/
  â”œâ”€â”€ backtests.js                   # å›žæµ‹æœåŠ¡
  â””â”€â”€ customIndicators.js            # è‡ªå®šä¹‰æŒ‡æ ‡æœåŠ¡

docs/
  â””â”€â”€ FRONTEND_UPDATES.md            # å‰ç«¯æ›´æ–°è¯´æ˜Ž
```

### æ–‡æ¡£ï¼ˆ3 ä¸ªæ–‡ä»¶ï¼‰
```
COMPLETE_UPDATE_GUIDE.md             # å®Œæ•´æ›´æ–°æŒ‡å—
QUICK_START.md                       # å¿«é€Ÿå¼€å§‹æŒ‡å—
UPDATE_SUMMARY.md                    # æ›´æ–°æ€»ç»“ï¼ˆæœ¬æ–‡ä»¶ï¼‰
```

**æ€»è®¡**: 20 ä¸ªæ–°æ–‡ä»¶

---

## ðŸ”„ ä¿®æ”¹çš„æ–‡ä»¶

### åŽç«¯ï¼ˆ3 ä¸ªï¼‰
- `main.py` - æ³¨å†Œæ–°è·¯ç”±
- `services/indicator_calculator.py` - æ·»åŠ  8 ä¸ªæ–°æŒ‡æ ‡
- `api/indicators.py` - æ›´æ–°æŒ‡æ ‡ç±»åž‹åˆ—è¡¨

### å‰ç«¯ï¼ˆ2 ä¸ªï¼‰
- `App.vue` - æ›´æ–°å¯¼èˆªèœå•
- `router/index.js` - æ·»åŠ æ–°è·¯ç”±

---

## ðŸŽ¯ æ ¸å¿ƒåŠŸèƒ½å±•ç¤º

### 1. å›žæµ‹å¼•æ“Žæ€§èƒ½æŒ‡æ ‡

```python
{
  "sharpe_ratio": 1.85,          # å¤æ™®æ¯”çŽ‡
  "annual_return": 0.25,         # å¹´åŒ–æ”¶ç›ŠçŽ‡ 25%
  "total_return": 0.18,          # æ€»æ”¶ç›ŠçŽ‡ 18%
  "max_drawdown": -0.15,         # æœ€å¤§å›žæ’¤ -15%
  "win_rate": 0.65,              # èƒœçŽ‡ 65%
  "total_trades": 24,            # äº¤æ˜“æ¬¡æ•°
  "winning_trades": 16,          # ç›ˆåˆ©äº¤æ˜“
  "losing_trades": 8             # äºæŸäº¤æ˜“
}
```

### 2. è‡ªå®šä¹‰æŒ‡æ ‡ç¤ºä¾‹

```python
# Z-Score æŒ‡æ ‡
{
  "name": "zscore",
  "formula": "(CLOSE - SMA(CLOSE, 20)) / STD(CLOSE, 20)",
  "params": [{"name": "period", "type": "int", "default": 20}]
}

# ä»·æ ¼åŠ¨é‡
{
  "name": "momentum",
  "formula": "CLOSE / REF(CLOSE, 10) - 1",
  "params": []
}

# æˆäº¤é‡æ¯”çŽ‡
{
  "name": "volume_ratio",
  "formula": "VOLUME / AVG(VOLUME, 20)",
  "params": []
}
```

### 3. ç­–ç•¥é…ç½®ç¤ºä¾‹

```json
{
  "name": "MACDé‡‘å‰ç­–ç•¥",
  "indicators": [
    {"type": "MACD", "params": {"fast_period": 12, "slow_period": 26, "signal_period": 9}},
    {"type": "RSI", "params": {"period": 14}}
  ],
  "conditions": [
    {"indicator": "DIF", "operator": ">", "value": "DEA", "action": "buy"},
    {"indicator": "RSI", "operator": "<", "value": 30, "action": "buy"},
    {"indicator": "DIF", "operator": "<", "value": "DEA", "action": "sell"}
  ]
}
```

---

## ðŸ“Š æŠ€æœ¯æŒ‡æ ‡å¯¹æ¯”

| ç±»åˆ« | æ›´æ–°å‰ | æ›´æ–°åŽ | æ–°å¢ž |
|------|--------|--------|------|
| è¶‹åŠ¿ç±» | MA, MACD | MA, EMA, MACD, DMI | EMA, DMI |
| éœ‡è¡ç±» | RSI | RSI, KDJ, CCI, WR | KDJ, CCI, WR |
| æ³¢åŠ¨ç±» | BOLL | BOLL, ATR | ATR |
| æˆäº¤é‡ | - | OBV, VWAP | OBV, VWAP |
| **æ€»è®¡** | **4** | **12** | **8** |

---

## ðŸš€ API ç«¯ç‚¹ç»Ÿè®¡

### æ–°å¢žç«¯ç‚¹ï¼ˆ11 ä¸ªï¼‰

**å›žæµ‹ç›¸å…³ï¼ˆ4 ä¸ªï¼‰**:
```
POST   /api/backtests/run          # è¿è¡Œå›žæµ‹
GET    /api/backtests              # èŽ·å–å›žæµ‹åˆ—è¡¨
GET    /api/backtests/{id}         # èŽ·å–å›žæµ‹è¯¦æƒ…
DELETE /api/backtests/{id}         # åˆ é™¤å›žæµ‹
```

**è‡ªå®šä¹‰æŒ‡æ ‡ç›¸å…³ï¼ˆ6 ä¸ªï¼‰**:
```
POST   /api/custom-indicators                    # åˆ›å»ºæŒ‡æ ‡
GET    /api/custom-indicators                    # èŽ·å–æŒ‡æ ‡åˆ—è¡¨
GET    /api/custom-indicators/{id}               # èŽ·å–æŒ‡æ ‡è¯¦æƒ…
DELETE /api/custom-indicators/{id}               # åˆ é™¤æŒ‡æ ‡
POST   /api/custom-indicators/validate-formula   # éªŒè¯å…¬å¼
POST   /api/custom-indicators/calculate          # è®¡ç®—æŒ‡æ ‡
```

**æŒ‡æ ‡ç±»åž‹ï¼ˆ1 ä¸ªæ›´æ–°ï¼‰**:
```
GET    /api/indicators/types       # èŽ·å–æŒ‡æ ‡ç±»åž‹ï¼ˆä»Ž 4 ä¸ªæ›´æ–°åˆ° 12 ä¸ªï¼‰
```

---

## ðŸ’¾ æ•°æ®åº“å˜æ›´

### æ–°å¢žè¡¨ï¼ˆ2 ä¸ªï¼‰

**backtests** - å›žæµ‹ç»“æžœè¡¨
- ä¸»é”®: id (UUID)
- å¤–é”®: strategy_id â†’ strategies.id
- å­—æ®µ: 17 ä¸ªï¼ˆåŒ…æ‹¬æ€§èƒ½æŒ‡æ ‡å’Œäº¤æ˜“è®°å½•ï¼‰
- ç´¢å¼•: 3 ä¸ª

**custom_indicators** - è‡ªå®šä¹‰æŒ‡æ ‡è¡¨
- ä¸»é”®: id (UUID)
- å”¯ä¸€é”®: name
- å­—æ®µ: 11 ä¸ªï¼ˆåŒ…æ‹¬å…¬å¼å’Œå‚æ•°å®šä¹‰ï¼‰
- ç´¢å¼•: 2 ä¸ª

---

## ðŸŽ¨ å‰ç«¯é¡µé¢ç»Ÿè®¡

### æ–°å¢žé¡µé¢ï¼ˆ2 ä¸ªï¼‰

1. **ç­–ç•¥å›žæµ‹é¡µé¢** (`/backtest`)
   - è¿è¡Œå›žæµ‹æ ‡ç­¾é¡µ
   - å›žæµ‹åŽ†å²æ ‡ç­¾é¡µ
   - è¯¦ç»†æŠ¥å‘Šå¯¹è¯æ¡†
   - ç»„ä»¶æ•°: 15+

2. **è‡ªå®šä¹‰æŒ‡æ ‡é¡µé¢** (`/custom-indicator`)
   - æŒ‡æ ‡åˆ—è¡¨
   - åˆ›å»ºæŒ‡æ ‡å¯¹è¯æ¡†
   - æŸ¥çœ‹æŒ‡æ ‡å¯¹è¯æ¡†
   - æµ‹è¯•æŒ‡æ ‡å¯¹è¯æ¡†
   - ç»„ä»¶æ•°: 12+

### æ›´æ–°çš„ç»„ä»¶ï¼ˆ2 ä¸ªï¼‰

- å¯¼èˆªèœå•ï¼ˆæ–°å¢ž 2 ä¸ªèœå•é¡¹ï¼‰
- è·¯ç”±é…ç½®ï¼ˆæ–°å¢ž 2 ä¸ªè·¯ç”±ï¼‰

---

## ðŸ“ˆ ä»£ç ç»Ÿè®¡

### åŽç«¯ä»£ç é‡
```
æ–°å¢žä»£ç è¡Œæ•°: ~3,500 è¡Œ
  - å›žæµ‹å¼•æ“Ž: ~600 è¡Œ
  - è‡ªå®šä¹‰æŒ‡æ ‡å¼•æ“Ž: ~300 è¡Œ
  - æ‰©å±•æŒ‡æ ‡: ~800 è¡Œ
  - API ç«¯ç‚¹: ~800 è¡Œ
  - æ•°æ®æ¨¡åž‹: ~100 è¡Œ
  - æ–‡æ¡£: ~900 è¡Œ
```

### å‰ç«¯ä»£ç é‡
```
æ–°å¢žä»£ç è¡Œæ•°: ~2,000 è¡Œ
  - å›žæµ‹é¡µé¢: ~800 è¡Œ
  - è‡ªå®šä¹‰æŒ‡æ ‡é¡µé¢: ~700 è¡Œ
  - æœåŠ¡æ¨¡å—: ~200 è¡Œ
  - æ–‡æ¡£: ~300 è¡Œ
```

**æ€»è®¡**: ~5,500 è¡Œä»£ç 

---

## ðŸ”’ å®‰å…¨æ€§å¢žå¼º

1. **å…¬å¼å¼•æ“Žå®‰å…¨**:
   - ç¦æ­¢ä»£ç æ³¨å…¥
   - æ²™ç®±æ‰§è¡Œ
   - å‡½æ•°ç™½åå•
   - æ­£åˆ™æ£€æŸ¥

2. **API å®‰å…¨**:
   - å‚æ•°éªŒè¯
   - é”™è¯¯å¤„ç†
   - æ—¥å¿—è®°å½•

3. **æ•°æ®å®‰å…¨**:
   - å¤–é”®çº¦æŸ
   - å”¯ä¸€æ€§çº¦æŸ
   - æ•°æ®éªŒè¯

---

## âš¡ æ€§èƒ½ä¼˜åŒ–

1. **å›žæµ‹æ€§èƒ½**:
   - å•æ¬¡å›žæµ‹: < 5 ç§’ï¼ˆ252 äº¤æ˜“æ—¥ï¼‰
   - å†…å­˜å ç”¨: < 100MB

2. **æŒ‡æ ‡è®¡ç®—**:
   - å•ä¸ªæŒ‡æ ‡: < 1 ç§’ï¼ˆ1000 æ•°æ®ç‚¹ï¼‰
   - æ”¯æŒç¼“å­˜

3. **å‰ç«¯æ€§èƒ½**:
   - æ‡’åŠ è½½è·¯ç”±
   - ç»„ä»¶ç¼“å­˜
   - é˜²æŠ–å¤„ç†

---

## ðŸ“š æ–‡æ¡£å®Œæ•´æ€§

### æŠ€æœ¯æ–‡æ¡£ï¼ˆ7 ä¸ªï¼‰
- âœ… å®Œæ•´æ›´æ–°æŒ‡å—
- âœ… å¿«é€Ÿå¼€å§‹æŒ‡å—
- âœ… åŽç«¯åŠŸèƒ½è¯¦ç»†è¯´æ˜Ž
- âœ… åŽç«¯å‡çº§æ€»ç»“
- âœ… å‰ç«¯æ›´æ–°è¯´æ˜Ž
- âœ… æ›´æ–°æ€»ç»“ï¼ˆæœ¬æ–‡ä»¶ï¼‰
- âœ… æµ‹è¯•è„šæœ¬

### ä»£ç æ³¨é‡Š
- âœ… æ‰€æœ‰æ–°å¢žå‡½æ•°éƒ½æœ‰æ–‡æ¡£å­—ç¬¦ä¸²
- âœ… å¤æ‚é€»è¾‘éƒ½æœ‰æ³¨é‡Šè¯´æ˜Ž
- âœ… API ç«¯ç‚¹éƒ½æœ‰è¯´æ˜Žæ–‡æ¡£

---

## ðŸ§ª æµ‹è¯•è¦†ç›–

### åŠŸèƒ½æµ‹è¯•
- âœ… å›žæµ‹å¼•æ“Žæµ‹è¯•
- âœ… è‡ªå®šä¹‰æŒ‡æ ‡å¼•æ“Žæµ‹è¯•
- âœ… æ‰©å±•æŒ‡æ ‡æµ‹è¯•
- âœ… API ç«¯ç‚¹æµ‹è¯•

### æµ‹è¯•è„šæœ¬
- `backend/scripts/test_new_features.py`
- åŒ…å« 8 ä¸ªæµ‹è¯•åœºæ™¯
- è¦†ç›–æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½

---

## ðŸŽ¯ å®Œæˆåº¦

| åŠŸèƒ½ | åŽç«¯ | å‰ç«¯ | æ–‡æ¡£ | æµ‹è¯• | å®Œæˆåº¦ |
|------|------|------|------|------|--------|
| å¤æ™®æ¯”çŽ‡ | âœ… | âœ… | âœ… | âœ… | 100% |
| å›žæµ‹å¼•æ“Ž | âœ… | âœ… | âœ… | âœ… | 100% |
| ç­–ç•¥å…³è” | âœ… | âœ… | âœ… | âœ… | 100% |
| æ‰©å±•æŒ‡æ ‡ | âœ… | âœ… | âœ… | âœ… | 100% |
| è‡ªå®šä¹‰å…¬å¼ | âœ… | âœ… | âœ… | âœ… | 100% |
| æ’ä»¶æœºåˆ¶ | âœ… | - | âœ… | - | 80% |

**æ€»ä½“å®Œæˆåº¦**: 98%

---

## ðŸ”® åŽç»­è®¡åˆ’

### çŸ­æœŸï¼ˆ1-2 å‘¨ï¼‰
- [ ] å›žæµ‹ç»“æžœå¯è§†åŒ–ï¼ˆèµ„é‡‘æ›²çº¿å›¾è¡¨ï¼‰
- [ ] ç­–ç•¥å¯¹æ¯”åŠŸèƒ½
- [ ] å¯¼å‡ºå›žæµ‹æŠ¥å‘Š

### ä¸­æœŸï¼ˆ1-2 æœˆï¼‰
- [ ] æ‰¹é‡å›žæµ‹
- [ ] å‚æ•°ä¼˜åŒ–å™¨
- [ ] å®žæ—¶äº¤æ˜“æ‰§è¡Œ
- [ ] é£Žé™©ç®¡ç†æ¨¡å—

### é•¿æœŸï¼ˆ3-6 æœˆï¼‰
- [ ] æœºå™¨å­¦ä¹ æŒ‡æ ‡
- [ ] å› å­åˆ†æž
- [ ] é«˜é¢‘äº¤æ˜“æ”¯æŒ
- [ ] ç§»åŠ¨ç«¯åº”ç”¨

---

## ðŸ“ž æ”¯æŒä¿¡æ¯

### æ–‡æ¡£é“¾æŽ¥
- [å®Œæ•´æ›´æ–°æŒ‡å—](COMPLETE_UPDATE_GUIDE.md)
- [å¿«é€Ÿå¼€å§‹æŒ‡å—](QUICK_START.md)
- [åŽç«¯åŠŸèƒ½è¯¦ç»†è¯´æ˜Ž](backend/README_FEATURES.md)
- [å‰ç«¯æ›´æ–°è¯´æ˜Ž](frontend/FRONTEND_UPDATES.md)

### é—®é¢˜åé¦ˆ
- æäº¤ Issue
- å‘èµ· Pull Request
- æŸ¥çœ‹å·²çŸ¥é—®é¢˜åˆ—è¡¨

---

## ðŸŽ‰ æ€»ç»“

æœ¬æ¬¡æ›´æ–°æ˜¯ä¸€æ¬¡**é‡å¤§å‡çº§**ï¼Œå®Œå…¨è§£å†³äº†æ‚¨æå‡ºçš„æ‰€æœ‰é—®é¢˜ï¼š

âœ… **å¤æ™®æ¯”çŽ‡** - å®Œæ•´å®žçŽ°  
âœ… **å›žæµ‹åŠŸèƒ½** - ä¸“ä¸šçº§å›žæµ‹å¼•æ“Ž  
âœ… **ç­–ç•¥å…³è”** - çµæ´»çš„é…ç½®ç³»ç»Ÿ  
âœ… **æŒ‡æ ‡æ‰©å±•** - 3 å€æŒ‡æ ‡æ•°é‡  
âœ… **è‡ªå®šä¹‰å…¬å¼** - å®‰å…¨çš„å…¬å¼å¼•æ“Ž  
âœ… **å‰ç«¯ç•Œé¢** - å®Œæ•´çš„ç”¨æˆ·ä½“éªŒ  

ç³»ç»ŸçŽ°åœ¨å…·å¤‡äº†**ä¸“ä¸šé‡åŒ–äº¤æ˜“å¹³å°**çš„æ ¸å¿ƒèƒ½åŠ›ï¼

---

**æ›´æ–°æ—¥æœŸ**: 2026-02-08  
**ç‰ˆæœ¬**: 2.0.0  
**çŠ¶æ€**: âœ… å·²å®Œæˆ
