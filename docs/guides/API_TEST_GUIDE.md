# API æµ‹è¯•æŒ‡å—

## ðŸ” é—®é¢˜è¯Šæ–­

ä½ çš„ curl å‘½ä»¤ URL ä¸æ­£ç¡®ã€‚æ­£ç¡®çš„ URL åº”è¯¥åŒ…å« `/api` å‰ç¼€ã€‚

### âŒ é”™è¯¯çš„ URL
```bash
http://localhost:8000/backtests/run
```

### âœ… æ­£ç¡®çš„ URL
```bash
http://localhost:8000/api/backtests/run
```

---

## ðŸ§ª æµ‹è¯•æ­¥éª¤

### 1. æµ‹è¯•åŽç«¯å¥åº·çŠ¶æ€

```bash
curl http://localhost:8000/health
```

**é¢„æœŸå“åº”**:
```json
{"status": "healthy"}
```

---

### 2. æµ‹è¯•å›žæµ‹ API ç«¯ç‚¹

#### æ­¥éª¤ 1: èŽ·å–ç­–ç•¥åˆ—è¡¨

```bash
curl http://localhost:8000/api/strategies
```

**é¢„æœŸå“åº”**:
```json
{
  "strategies": [
    {
      "id": "ad7994b8-217a-4db1-98eb-1dc77090cc32",
      "name": "æµ‹è¯•ç­–ç•¥",
      ...
    }
  ]
}
```

#### æ­¥éª¤ 2: è¿è¡Œå›žæµ‹ï¼ˆä¿®æ­£åŽçš„å‘½ä»¤ï¼‰

```bash
curl -X POST 'http://localhost:8000/api/backtests/run' \
  -H 'Content-Type: application/json' \
  -d '{
    "strategy_id": "ad7994b8-217a-4db1-98eb-1dc77090cc32",
    "stock_code": "000002.SZ",
    "start_date": "2024-01-01",
    "end_date": "2024-12-31",
    "initial_capital": 100000,
    "commission_rate": 0.0003,
    "slippage_rate": 0.0001
  }'
```

**æ³¨æ„**: 
- æ—¥æœŸèŒƒå›´æ”¹ä¸º 2024 å¹´ï¼ˆ2025-2026 å¯èƒ½æ²¡æœ‰æ•°æ®ï¼‰
- URL åŒ…å« `/api` å‰ç¼€

---

### 3. å‰ç«¯é…ç½®æ£€æŸ¥

#### æ£€æŸ¥ API é…ç½®æ–‡ä»¶

æ–‡ä»¶: `frontend/src/services/api.js`

**æ­£ç¡®é…ç½®**:
```javascript
const apiClient = axios.create({
  baseURL: 'http://localhost:8000/api',  // åŒ…å« /api
  timeout: 30000,
  headers: {
    'Content-Type': 'application/json'
  }
})
```

#### æ£€æŸ¥çŽ¯å¢ƒå˜é‡

æ–‡ä»¶: `frontend/.env` (å¦‚æžœå­˜åœ¨)

```env
VITE_API_BASE_URL=http://localhost:8000/api
```

---

## ðŸ”§ ä¿®å¤æ­¥éª¤

### å¦‚æžœå‰ç«¯å·²ç»åœ¨è¿è¡Œ

1. **åœæ­¢å‰ç«¯æœåŠ¡** (Ctrl+C)

2. **æ¸…é™¤ç¼“å­˜**:
```bash
cd frontend
rm -rf node_modules/.vite
```

3. **é‡æ–°å¯åŠ¨**:
```bash
npm run dev
```

4. **å¼ºåˆ¶åˆ·æ–°æµè§ˆå™¨** (Ctrl+Shift+R æˆ– Cmd+Shift+R)

---

## ðŸ“ å®Œæ•´çš„å›žæµ‹æµ‹è¯•æµç¨‹

### æ­¥éª¤ 1: ç¡®ä¿æœ‰ Kçº¿æ•°æ®

```bash
# æ£€æŸ¥æ˜¯å¦æœ‰æ•°æ®
curl "http://localhost:8000/api/stocks/000002.SZ/kline?start_date=2024-01-01&end_date=2024-12-31"
```

å¦‚æžœè¿”å›žç©ºæ•°æ®ï¼Œéœ€è¦å…ˆèŽ·å–æ•°æ®ï¼š
```bash
# å‰ç«¯è®¿é—®å›¾è¡¨é¡µé¢ï¼Œé€‰æ‹©è‚¡ç¥¨åŠ è½½æ•°æ®
# æˆ–ä½¿ç”¨ API èŽ·å–
```

### æ­¥éª¤ 2: åˆ›å»ºç­–ç•¥

```bash
curl -X POST 'http://localhost:8000/api/strategies' \
  -H 'Content-Type: application/json' \
  -d '{
    "name": "MAäº¤å‰ç­–ç•¥",
    "description": "5æ—¥å‡çº¿ä¸Šç©¿20æ—¥å‡çº¿ä¹°å…¥",
    "indicators": [
      {
        "type": "MA",
        "params": {"periods": [5, 20]}
      }
    ],
    "conditions": [
      {
        "indicator": "MA5",
        "operator": ">",
        "value": "MA20",
        "action": "buy"
      },
      {
        "indicator": "MA5",
        "operator": "<",
        "value": "MA20",
        "action": "sell"
      }
    ]
  }'
```

**è®°å½•è¿”å›žçš„ strategy_id**

### æ­¥éª¤ 3: è¿è¡Œå›žæµ‹

```bash
curl -X POST 'http://localhost:8000/api/backtests/run' \
  -H 'Content-Type: application/json' \
  -d '{
    "strategy_id": "YOUR_STRATEGY_ID",
    "stock_code": "000002.SZ",
    "start_date": "2024-01-01",
    "end_date": "2024-12-31",
    "initial_capital": 100000,
    "commission_rate": 0.0003,
    "slippage_rate": 0.0001
  }'
```

### æ­¥éª¤ 4: æŸ¥çœ‹ç»“æžœ

```bash
# èŽ·å–å›žæµ‹åˆ—è¡¨
curl 'http://localhost:8000/api/backtests'

# èŽ·å–è¯¦ç»†ç»“æžœ
curl 'http://localhost:8000/api/backtests/BACKTEST_ID'
```

---

## ðŸ› å¸¸è§é”™è¯¯åŠè§£å†³æ–¹æ¡ˆ

### é”™è¯¯ 1: 404 Not Found

**åŽŸå› **: URL è·¯å¾„ä¸æ­£ç¡®

**è§£å†³æ–¹æ¡ˆ**:
- ç¡®ä¿ URL åŒ…å« `/api` å‰ç¼€
- æ£€æŸ¥ç«¯ç‚¹è·¯å¾„æ˜¯å¦æ­£ç¡®

**æ­£ç¡®ç¤ºä¾‹**:
```
âœ… http://localhost:8000/api/backtests/run
âŒ http://localhost:8000/backtests/run
```

---

### é”™è¯¯ 2: ç­–ç•¥ä¸å­˜åœ¨

**é”™è¯¯ä¿¡æ¯**:
```json
{
  "detail": "ç­–ç•¥ä¸å­˜åœ¨"
}
```

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥ strategy_id æ˜¯å¦æ­£ç¡®
2. ä½¿ç”¨ `GET /api/strategies` èŽ·å–æœ‰æ•ˆçš„ç­–ç•¥ ID

---

### é”™è¯¯ 3: æ²¡æœ‰æ‰¾åˆ°Kçº¿æ•°æ®

**é”™è¯¯ä¿¡æ¯**:
```json
{
  "detail": "æ²¡æœ‰æ‰¾åˆ°Kçº¿æ•°æ®"
}
```

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥è‚¡ç¥¨ä»£ç æ˜¯å¦æ­£ç¡®ï¼ˆå¦‚ `000002.SZ`ï¼‰
2. æ£€æŸ¥æ—¥æœŸèŒƒå›´æ˜¯å¦æœ‰æ•°æ®
3. å…ˆè®¿é—®å‰ç«¯å›¾è¡¨é¡µé¢åŠ è½½æ•°æ®
4. æˆ–ä½¿ç”¨ API èŽ·å–æ•°æ®ï¼š
```bash
curl "http://localhost:8000/api/stocks/000002.SZ/kline?start_date=2024-01-01&end_date=2024-12-31"
```

---

### é”™è¯¯ 4: CORS é”™è¯¯

**é”™è¯¯ä¿¡æ¯**: æµè§ˆå™¨æŽ§åˆ¶å°æ˜¾ç¤º CORS é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥åŽç«¯ CORS é…ç½®
2. ç¡®ä¿å‰ç«¯ URL åœ¨å…è®¸åˆ—è¡¨ä¸­
3. é‡å¯åŽç«¯æœåŠ¡

---

### é”™è¯¯ 5: è¶…æ—¶é”™è¯¯

**é”™è¯¯ä¿¡æ¯**: Request timeout

**è§£å†³æ–¹æ¡ˆ**:
1. å‰ç«¯å·²å°†è¶…æ—¶æ—¶é—´å¢žåŠ åˆ° 30 ç§’
2. å¦‚æžœä»ç„¶è¶…æ—¶ï¼Œç¼©çŸ­å›žæµ‹æ—¶é—´èŒƒå›´
3. æ£€æŸ¥åŽç«¯æ—¥å¿—æŸ¥çœ‹å…·ä½“é”™è¯¯

---

## ðŸ“Š éªŒè¯æ¸…å•

å®Œæˆä»¥ä¸‹æ£€æŸ¥ç¡®ä¿ç³»ç»Ÿæ­£å¸¸ï¼š

### åŽç«¯æ£€æŸ¥
- [ ] åŽç«¯æœåŠ¡æ­£åœ¨è¿è¡Œ (http://localhost:8000)
- [ ] å¥åº·æ£€æŸ¥é€šè¿‡ (`/health`)
- [ ] API ç«¯ç‚¹å¯è®¿é—® (`/api/strategies`)
- [ ] æ•°æ®åº“è¿ç§»å·²å®Œæˆ

### å‰ç«¯æ£€æŸ¥
- [ ] å‰ç«¯æœåŠ¡æ­£åœ¨è¿è¡Œ (http://localhost:5173)
- [ ] API baseURL é…ç½®æ­£ç¡® (åŒ…å« `/api`)
- [ ] æµè§ˆå™¨æŽ§åˆ¶å°æ— é”™è¯¯
- [ ] ç½‘ç»œè¯·æ±‚ URL æ­£ç¡®

### æ•°æ®æ£€æŸ¥
- [ ] æœ‰å¯ç”¨çš„ç­–ç•¥
- [ ] æœ‰ Kçº¿æ•°æ®
- [ ] æ—¥æœŸèŒƒå›´åˆç†ï¼ˆå»ºè®®ä½¿ç”¨ 2024 å¹´ï¼‰

---

## ðŸŽ¯ å¿«é€Ÿæµ‹è¯•å‘½ä»¤

### ä¸€é”®æµ‹è¯•æ‰€æœ‰ç«¯ç‚¹

```bash
#!/bin/bash

echo "1. æµ‹è¯•å¥åº·çŠ¶æ€..."
curl -s http://localhost:8000/health | jq

echo -e "\n2. æµ‹è¯•ç­–ç•¥åˆ—è¡¨..."
curl -s http://localhost:8000/api/strategies | jq

echo -e "\n3. æµ‹è¯•æŒ‡æ ‡ç±»åž‹..."
curl -s http://localhost:8000/api/indicators/types | jq

echo -e "\n4. æµ‹è¯•å›žæµ‹åˆ—è¡¨..."
curl -s http://localhost:8000/api/backtests | jq

echo -e "\n5. æµ‹è¯•è‡ªå®šä¹‰æŒ‡æ ‡åˆ—è¡¨..."
curl -s http://localhost:8000/api/custom-indicators | jq

echo -e "\nâœ… æ‰€æœ‰æµ‹è¯•å®Œæˆ"
```

ä¿å­˜ä¸º `test_api.sh`ï¼Œç„¶åŽè¿è¡Œï¼š
```bash
chmod +x test_api.sh
./test_api.sh
```

---

## ðŸ’¡ è°ƒè¯•æŠ€å·§

### 1. æŸ¥çœ‹åŽç«¯æ—¥å¿—

```bash
# å¦‚æžœä½¿ç”¨ python ç›´æŽ¥è¿è¡Œ
cd backend
python main.py

# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
```

### 2. æŸ¥çœ‹å‰ç«¯ç½‘ç»œè¯·æ±‚

1. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…· (F12)
2. åˆ‡æ¢åˆ° Network æ ‡ç­¾
3. è¿è¡Œå›žæµ‹
4. æŸ¥çœ‹è¯·æ±‚ URL å’Œå“åº”

### 3. ä½¿ç”¨ Postman æµ‹è¯•

1. å¯¼å…¥ API ç«¯ç‚¹
2. è®¾ç½® baseURL: `http://localhost:8000/api`
3. é€ä¸ªæµ‹è¯•ç«¯ç‚¹

---

## ðŸ“ž éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æžœé—®é¢˜ä»ç„¶å­˜åœ¨ï¼š

1. **æ£€æŸ¥åŽç«¯æ—¥å¿—** - æŸ¥çœ‹å…·ä½“é”™è¯¯ä¿¡æ¯
2. **æ£€æŸ¥æµè§ˆå™¨æŽ§åˆ¶å°** - æŸ¥çœ‹å‰ç«¯é”™è¯¯
3. **éªŒè¯æ•°æ®** - ç¡®ä¿æœ‰ç­–ç•¥å’Œ Kçº¿æ•°æ®
4. **é‡å¯æœåŠ¡** - å‰åŽç«¯éƒ½é‡å¯è¯•è¯•

---

## âœ… æˆåŠŸæ ‡å¿—

å½“ä¸€åˆ‡æ­£å¸¸æ—¶ï¼Œä½ åº”è¯¥çœ‹åˆ°ï¼š

### å‰ç«¯
- å›žæµ‹é¡µé¢å¯ä»¥æ­£å¸¸è®¿é—®
- å¯ä»¥é€‰æ‹©ç­–ç•¥å’Œè‚¡ç¥¨
- ç‚¹å‡»"å¼€å§‹å›žæµ‹"åŽæ˜¾ç¤ºåŠ è½½çŠ¶æ€
- å‡ ç§’åŽæ˜¾ç¤ºå›žæµ‹ç»“æžœ
- ç»“æžœåŒ…å«å¤æ™®æ¯”çŽ‡ç­‰æŒ‡æ ‡

### åŽç«¯
- æ—¥å¿—æ˜¾ç¤ºå›žæµ‹è¯·æ±‚
- æ—¥å¿—æ˜¾ç¤ºæŒ‡æ ‡è®¡ç®—
- æ—¥å¿—æ˜¾ç¤ºå›žæµ‹å®Œæˆ
- æ— é”™è¯¯ä¿¡æ¯

### API å“åº”
```json
{
  "backtest_id": "xxx-xxx-xxx",
  "metrics": {
    "sharpe_ratio": 1.85,
    "annual_return": 0.25,
    "max_drawdown": -0.15,
    "win_rate": 0.65,
    ...
  },
  "message": "å›žæµ‹å®Œæˆ"
}
```

---

çŽ°åœ¨é‡æ–°æµ‹è¯•ï¼Œä½¿ç”¨æ­£ç¡®çš„ URLï¼š`http://localhost:8000/api/backtests/run` ðŸš€
