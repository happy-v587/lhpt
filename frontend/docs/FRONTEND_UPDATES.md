# 前端更新说明

## 概述

前端已同步更新，添加了对应后端新功能的完整用户界面。

---

## 新增页面

### 1. 策略回测页面 (`/backtest`)

**文件**: `frontend/src/views/BacktestView.vue`

**功能**:
- ✅ 运行策略回测
- ✅ 配置回测参数（初始资金、手续费率、滑点率）
- ✅ 实时显示回测结果
- ✅ 查看夏普比率和性能指标
- ✅ 回测历史记录管理
- ✅ 详细回测报告查看

**主要特性**:
- 选择策略和股票
- 设置回测时间范围
- 自定义交易成本参数
- 可视化性能指标展示
- 夏普比率评级（卓越/优秀/良好/一般/较差）
- 交易记录详情
- 资金曲线展示

**使用流程**:
1. 选择已创建的策略
2. 选择股票代码
3. 设置回测时间范围
4. 配置初始资金和交易成本
5. 点击"开始回测"
6. 查看结果和详细报告

---

### 2. 自定义指标页面 (`/custom-indicator`)

**文件**: `frontend/src/views/CustomIndicatorView.vue`

**功能**:
- ✅ 创建自定义指标
- ✅ 公式编辑和验证
- ✅ 参数配置
- ✅ 指标测试
- ✅ 指标管理（查看、删除）

**主要特性**:
- 可视化公式编辑器
- 实时公式验证
- 参数类型支持（整数、浮点、字符串）
- 指标测试功能
- 指标列表管理

**支持的公式函数**:
```
数学函数: abs, sqrt, log, exp, pow
聚合函数: sum, avg, max, min, std
技术函数: ema, sma, ref, cross, cross_up, cross_down
数据变量: OPEN, CLOSE, HIGH, LOW, VOLUME
```

**使用流程**:
1. 点击"创建指标"
2. 输入指标名称和显示名称
3. 编写公式（如: `(CLOSE - SMA(CLOSE, 20)) / STD(CLOSE, 20)`）
4. 点击"验证公式"确认语法正确
5. 添加参数定义（可选）
6. 保存指标
7. 测试指标计算

---

## 更新的组件

### 1. 导航菜单 (`App.vue`)

**新增菜单项**:
- 自定义指标 - 管理自定义技术指标
- 策略回测 - 运行和查看回测结果

**图标**:
- 自定义指标: Tools 图标
- 策略回测: VideoPlay 图标

---

### 2. 路由配置 (`router/index.js`)

**新增路由**:
```javascript
{
  path: '/backtest',
  name: 'backtest',
  component: () => import('../views/BacktestView.vue')
},
{
  path: '/custom-indicator',
  name: 'custom-indicator',
  component: () => import('../views/CustomIndicatorView.vue')
}
```

---

## 新增服务模块

### 1. 回测服务 (`services/backtests.js`)

**API 方法**:
```javascript
runBacktest(config)           // 运行回测
getBacktests(strategyId)      // 获取回测列表
getBacktestDetail(backtestId) // 获取回测详情
deleteBacktest(backtestId)    // 删除回测
```

---

### 2. 自定义指标服务 (`services/customIndicators.js`)

**API 方法**:
```javascript
createCustomIndicator(indicator)      // 创建指标
getCustomIndicators(activeOnly)       // 获取指标列表
getCustomIndicator(indicatorId)       // 获取指标详情
deleteCustomIndicator(indicatorId)    // 删除指标
validateFormula(formula)              // 验证公式
calculateCustomIndicator(config)      // 计算指标
```

---

## 界面截图说明

### 策略回测页面

**运行回测标签页**:
- 策略选择下拉框
- 股票选择器
- 日期范围选择器
- 初始资金输入（默认 100,000）
- 手续费率输入（默认 0.0003）
- 滑点率输入（默认 0.0001）
- "开始回测"按钮

**回测结果展示**:
- 夏普比率（带评级标签）
- 年化收益率
- 最大回撤
- 胜率
- 初始/最终资金
- 总收益率
- 交易次数
- "查看详细报告"按钮

**回测历史标签页**:
- 表格显示所有历史回测
- 列：股票代码、回测时间、夏普比率、总收益率、创建时间
- 操作：查看详情、删除

**详细报告对话框**:
- 性能指标描述列表
- 交易记录表格（日期、操作、股数、价格、金额、手续费）

---

### 自定义指标页面

**指标列表**:
- 表格显示所有自定义指标
- 列：指标名称、标识符、描述、公式、状态、创建时间
- 操作：查看、测试、删除

**创建指标对话框**:
- 指标名称输入（英文标识符）
- 显示名称输入（中文名称）
- 描述输入（多行文本）
- 公式输入（多行文本，带验证按钮）
- 参数定义区域（可添加多个参数）
  - 参数名
  - 参数类型（整数/浮点/字符串）
  - 默认值
  - 说明
- 函数提示信息

**查看指标对话框**:
- 指标详细信息展示
- 描述列表格式

**测试指标对话框**:
- 股票选择器
- 时间范围选择器
- 参数输入（根据指标定义动态生成）
- "计算"按钮
- 计算结果展示

---

## 样式和交互

### 设计规范

**颜色方案**:
- 主色调: Element Plus 默认蓝色 (#409eff)
- 成功: 绿色 (#67c23a)
- 警告: 橙色 (#e6a23c)
- 危险: 红色 (#f56c6c)
- 信息: 灰色 (#909399)

**夏普比率评级颜色**:
- 卓越 (>3): success (绿色)
- 优秀 (2-3): success (绿色)
- 良好 (1-2): warning (橙色)
- 一般 (0-1): info (灰色)
- 较差 (<0): danger (红色)

**布局**:
- 最大宽度: 1400px
- 卡片间距: 20px
- 表单标签宽度: 120px
- 响应式设计

**交互反馈**:
- 加载状态: Loading 动画
- 成功操作: 成功消息提示
- 错误操作: 错误消息提示
- 确认操作: 确认对话框

---

## 数据流

### 回测流程

```
用户选择策略 → 配置参数 → 点击运行
    ↓
前端发送请求到 /api/backtests/run
    ↓
后端执行回测引擎
    ↓
返回结果（包含夏普比率等指标）
    ↓
前端展示结果和评级
    ↓
用户可查看详细报告或历史记录
```

### 自定义指标流程

```
用户创建指标 → 输入公式 → 验证公式
    ↓
前端发送验证请求到 /api/custom-indicators/validate-formula
    ↓
后端验证公式语法和安全性
    ↓
返回验证结果
    ↓
用户保存指标
    ↓
前端发送创建请求到 /api/custom-indicators
    ↓
后端保存到数据库
    ↓
前端刷新指标列表
```

---

## 错误处理

### 回测错误

- 策略不存在: "策略不存在"
- 没有K线数据: "没有找到K线数据"
- 回测失败: 显示后端返回的详细错误信息

### 自定义指标错误

- 指标名称重复: "指标名称已存在"
- 公式验证失败: 显示具体的语法错误
- 计算失败: 显示计算错误详情

---

## 性能优化

1. **懒加载**: 所有页面组件使用动态导入
2. **数据缓存**: API 响应数据在组件内缓存
3. **防抖处理**: 公式验证使用防抖避免频繁请求
4. **分页加载**: 大量数据使用分页或虚拟滚动

---

## 兼容性

- 现代浏览器（Chrome, Firefox, Safari, Edge）
- 响应式设计，支持桌面和平板
- Element Plus 组件库保证一致的用户体验

---

## 使用指南

### 运行回测

1. 访问 `/backtest` 页面
2. 在"运行回测"标签页中：
   - 选择策略（需要先在策略管理页面创建）
   - 选择股票代码
   - 设置回测时间范围
   - 调整初始资金和交易成本（可选）
3. 点击"开始回测"
4. 等待计算完成（通常几秒钟）
5. 查看结果：
   - 夏普比率及评级
   - 年化收益率
   - 最大回撤
   - 胜率
   - 其他性能指标
6. 点击"查看详细报告"查看交易记录

### 创建自定义指标

1. 访问 `/custom-indicator` 页面
2. 点击"创建指标"按钮
3. 填写表单：
   - 指标名称: 英文标识符（如 `zscore`）
   - 显示名称: 中文名称（如 `Z-Score`）
   - 描述: 指标说明（可选）
   - 公式: 计算公式（如 `(CLOSE - SMA(CLOSE, 20)) / STD(CLOSE, 20)`）
4. 点击"验证公式"确认语法正确
5. 添加参数（可选）：
   - 点击"添加参数"
   - 输入参数名、类型、默认值、说明
6. 点击"创建"保存指标
7. 在列表中找到新创建的指标
8. 点击"测试"验证指标计算

---

## 后续改进

### 短期
- [ ] 回测结果可视化（资金曲线图表）
- [ ] 策略对比功能
- [ ] 导出回测报告（PDF/Excel）
- [ ] 自定义指标公式编辑器增强（语法高亮）

### 中期
- [ ] 实时回测进度显示
- [ ] 批量回测功能
- [ ] 指标库（预置常用指标）
- [ ] 策略优化器（参数寻优）

### 长期
- [ ] 移动端适配
- [ ] 实时数据推送
- [ ] 社区分享功能
- [ ] 机器学习指标

---

## 文件清单

### 新增文件
```
frontend/src/views/BacktestView.vue
frontend/src/views/CustomIndicatorView.vue
frontend/src/services/backtests.js
frontend/src/services/customIndicators.js
frontend/FRONTEND_UPDATES.md
```

### 修改文件
```
frontend/src/App.vue
frontend/src/router/index.js
```

---

## 测试建议

### 功能测试

1. **回测功能**:
   - 创建一个简单的MA交叉策略
   - 选择一只股票运行回测
   - 验证夏普比率计算正确
   - 检查交易记录是否合理
   - 测试删除回测记录

2. **自定义指标**:
   - 创建一个简单公式（如 `CLOSE / OPEN`）
   - 验证公式语法检查
   - 测试指标计算
   - 尝试创建复杂公式
   - 测试参数化指标

### 边界测试

1. 空数据处理
2. 错误输入处理
3. 网络错误处理
4. 长时间回测处理

---

## 常见问题

**Q: 回测运行很慢怎么办？**
A: 缩短回测时间范围，或选择数据量较小的股票。

**Q: 自定义指标公式报错？**
A: 使用"验证公式"功能检查语法，确保函数名和参数正确。

**Q: 夏普比率为负数正常吗？**
A: 正常，表示策略表现不如无风险资产（如国债）。

**Q: 如何在策略中使用自定义指标？**
A: 目前自定义指标主要用于测试和分析，后续版本将支持在策略中引用。

---

## 联系方式

如有问题或建议，请提交 Issue 或 Pull Request。
